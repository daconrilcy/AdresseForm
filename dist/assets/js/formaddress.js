export const divAddressName="divadress";export const inputAddressTagName="inputaddress";export const divParentAddressChoixName="divaddresschoix";export const inputAddressRefTagName="inputrefaddress";export const inputAddressNoTagName="inputnoaddress";export const inputAddressStreetTagName="inputstreetaddress";export const inputAddressLatTagName="inputlataddress";export const inputAddressLonTagName="inputlonaddress";export const typageAddressChoix="typeaddresschoix";export const divZipCodeName="divzipcode";export const inputZipCodeTagName="inputzipcode";export const divParenttZipCodeChoixName="divzipcodechoix";export const typageZipCodeChoix="typezipcodechoix";export const divCityName="divcity";export const inputCityTagName="inputcity";export const divParentCityChoixName="divcitychoix";export const typageCityChoix="typecitychoix";export const inputCityCodeTagName="inputcodecity";export const classNameDivChoixParent="mb-3 dropdown-menu relative";export const classNameDivChild="myMenu";export const inputTagAuto="data-auto";export const inputTagName="data-name";export const divTagType="data-type";export const tagsNamesAddressChild={id:"data-id",no:"data-no",street:"data-street",zipcode:"data-zipcode",codecity:"data-codecity",city:"data-city",lon:"data-lon",lat:"data-lat",short:"data-short",long:"text"};export const tagsNamesGeoChild={zipcode:"data-zipcode",codecity:"data-codecity",city:"data-city",departcode:"data-departcode",departnom:"data-departnom"};export const FiedsNamesAddressJson={id:"id",no:"no",street:"street",zipcode:"zipcode",codecity:"codecity",city:"city",lon:"lon",lat:"lat",short:"short",long:"long"};export const FieldsNameGeoJson={zipcode:"zipcode",codecity:"codecity",city:"city",departcode:"departcode",departnom:"departnom"};export const nonAutoDefaultValue="NaN";export const FormAddrDefaultTimout=1e3;export const NbMaxAddressReturnJson=15;export const NbMaxZipCodeReturnJson=10;export const NbMaxCityReturnJson=25;export const miniInput={inputAddressTagName:3,inputZipCodeTagName:3,inputCityTagName:2};export const classShow="show";export const ApiGouv=class{async getCityFromZipBrut(t){return fetch("https://geo.api.gouv.fr/communes?codePostal="+t+"&fields=departement&boost=population&limit=10",{method:"GET"}).then((t=>t.json()))}async getCityFromCityBrute(t){return fetch("https://geo.api.gouv.fr/communes?nom="+t+"&fields=departement,codesPostaux&boost=population&limit=25",{method:"GET"}).then((t=>t.json()))}async getAdressBrute(t){return fetch("https://api-adresse.data.gouv.fr/search/?q="+t+"&limit=15",{method:"GET"}).then((t=>t.json()))}async getAddressData(t){return this.getAdressBrute(t).then((t=>{let e=[],s=t.features;return s.length>0&&s.forEach((t=>{let s={};s.id=t.properties.id,s.no=t.properties.housenumber,s.street=t.properties.street,s.zipcode=t.properties.postcode,s.codecity=t.properties.citycode,s.city=t.properties.city,s.lat=t.geometry.coordinates[1],s.lon=t.geometry.coordinates[0],s.short=t.properties.name,s.long=t.properties.label,s=this.checkValidityValue(s),e.push(s)})),e}))}async getCityFromZip(t){return this.getCityFromZipBrut(t).then((e=>this.formatedValuesFromGeo(e,t)))}async getCityFromCity(t){return this.getCityFromCityBrute(t).then((t=>{let e=this.checkCityZipCodes(t);return this.formatedValuesFromGeo(e)}))}checkCityZipCodes(t){let e=[];return t.length>0&&t.forEach((t=>{if(t.hasOwnProperty("codesPostaux"))for(let s in t.codesPostaux)if(t.codesPostaux.hasOwnProperty(s)){let i={};for(let e in t)t.hasOwnProperty(e)&&(i[e]=t[e]);i.codesPostaux=t.codesPostaux[s],e.push(i)}})),e}formatedValuesFromGeo(t=[],e=""){let s=[];return t.length>0&&t.forEach((t=>{let i={};t.hasOwnProperty("codesPostaux")?i[FieldsNameGeoJson.zipcode]=t.codesPostaux:i[FieldsNameGeoJson.zipcode]=e,i[FieldsNameGeoJson.city]=t.nom,i[FieldsNameGeoJson.codecity]=t.code,i[FieldsNameGeoJson.departcode]=t.departement.code,i[FieldsNameGeoJson.departnom]=t.departement.nom,i=this.checkValidityValue(i),s.push(i)})),s}checkValidityValue(t){for(let e in t)t.hasOwnProperty(e)&&(void 0!==t[e]&&null!==t[e]||(t[e]=""));return t}async getDataIdTag(t,e){switch(e){case"inputaddress":return this.getAddressData(t);case"inputzipcode":return this.getCityFromZip(t);case"inputcity":return this.getCityFromCity(t)}}};const DivManagement=class{#t;#e;#s;#i;constructor(t,e,s){this.createFrame(t,e,s)}createFrame(t,e,s){this.#t=document.createElement("div"),this.setClass(s),this.#t.className=s,this.setId(t),this.#e=document.getElementById(e)}attachToParent(t=""){""!==t&&(this.#e=document.getElementById(t)),null!==this.#e&&void 0!==this.#e&&this.#e.appendChild(this.#t)}getDiv(){return this.#t}setClass(t){this.#s=t,this.#t.className=t}addClass(t){this.#t.classList.add(t),this.#s=this.#t.className}removeClass(t){this.#t.classList.remove(t),this.#s=this.#t.className}putText(t){this.#t.childNodes[0].textContent=t}setId(t){null!=t&&""!==t||(t=idAlea()),this.#i=t,this.#t.id=t,this.#t.setAttribute("name",t)}getId(){return this.#t.id}show(){this.addClass("show")}hide(){this.removeClass("show")}},DivChoixParent=class extends DivManagement{constructor(t,e){super(t,e,classNameDivChoixParent),this.attachToParent(e)}},divParentAddressChoix=class extends DivChoixParent{constructor(){super("divaddresschoix","divadress")}},divParentZipCodeChoix=class extends DivChoixParent{constructor(){super("divzipcodechoix","divzipcode")}},divParentCityChoix=class extends DivChoixParent{constructor(){super("divcitychoix","divcity")}};class DivChoixChild extends DivManagement{typeChild;jsonStruct={};tagNamesStruct={};#d;#o;constructor(t="",e,s,i={},d={}){super(t,e,"myMenu"),this.typeChild=s,this.tagNamesStruct=i,this.jsonStruct=d,this.#d={},this.#o="";const o=document.createTextNode("");this.getDiv().appendChild(o),this.getDiv().setAttribute(divTagType,s)}setDatas(t){this.#d=t}getDatas(){return this.#d}setTextContent(t){this.#o=t}putText(){this.getDiv().childNodes[0].textContent=this.#o}getTextContent(){return this.#o}}class divChoixAdressChild extends DivChoixChild{constructor(){super("","divaddresschoix","typeaddresschoix",tagsNamesAddressChild,FiedsNamesAddressJson)}setTextFromAddres(t){this.setTextContent(t.long)}}class divChoixZipCodeChild extends DivChoixChild{constructor(){super("","divzipcodechoix","typezipcodechoix",tagsNamesGeoChild,FieldsNameGeoJson)}setTextFromAddres(t){this.setTextContent(t[FieldsNameGeoJson.city])}}class divChoixCityChild extends DivChoixChild{constructor(){super("","divcitychoix","typecitychoix",tagsNamesGeoChild,FieldsNameGeoJson)}setTextFromAddres(t){let e=t[FieldsNameGeoJson.city]+" ("+t[FieldsNameGeoJson.zipcode]+"), "+t[FieldsNameGeoJson.departnom];this.setTextContent(e)}}export const FullChoixFormAddress=class{#e;#a=[];#n;#r;#h;constructor(t){this.#n=t,this.#a=[],this.createParentChildrenChoix()}createParentChildrenChoix(){switch(this.#n){case"typeaddresschoix":this.#e=new divParentAddressChoix,this.createEmptyChildrenChoixAddress();break;case"typezipcodechoix":this.#e=new divParentZipCodeChoix,this.createEmptyChildrenChoixZipCode();break;case"typecitychoix":this.#e=new divParentCityChoix,this.createEmptyChildrenChoixCity()}}addChilds(t){this.#a.push(t)}createEmptyChildrenChoixAddress(){for(let t=0;t<15;t++){let t=new divChoixAdressChild;this.addChilds(t)}}createEmptyChildrenChoixZipCode(){for(let t=0;t<10;t++){let t=new divChoixZipCodeChild;this.addChilds(t)}}createEmptyChildrenChoixCity(){for(let t=0;t<25;t++){let t=new divChoixCityChild;this.addChilds(t)}}fillChilds(t){if(t.length>0){let e=t.length;this.#a.length<t.length&&(e=this.#a.length),this.#h=e;for(let e=0;e<this.#h;e++)this.#a[e].setDatas(t[e]),this.#a[e].setTextFromAddres(t[e]);this.affichChilds()}}affichChilds(){for(let t=0;t<this.#h;t++)""!==this.#a[t].getTextContent()&&void 0!==this.#a[t]&&null!==this.#a[t]&&(this.#a[t].attachToParent(),this.#a[t].putText(),this.#e.show())}hideChilds(){this.#e.hide()}setSelectedChild(t){for(let e=0;e<this.#a.length;e++)this.#a[e].getId()===t&&(this.#r=this.#a[e])}getDatafromId(t){return this.setSelectedChild(t),this.#r.getDatas()}};function idAlea(){const t="abcdefghijklmnopqrstuvwxyz1234567890";let e="";for(let s=0;s<15;s++){e+=t[Math.floor(Math.random()*t.length)]}return e}export const FormActions=class{#p;#l;#c;#u;#C;fromToTag;constructor(){this.#c=new ApiGouv,this.#u=new FormAddressInputs,this.#p={},this.#p.inputaddress=new FullChoixFormAddress("typeaddresschoix"),this.#p.inputzipcode=new FullChoixFormAddress("typezipcodechoix"),this.#p.inputcity=new FullChoixFormAddress("typecitychoix"),this.#C={},this.#C.inputaddress="",this.#C.inputzipcode="",this.#C.inputcity="",this.fromToTag={},this.fromToTag.typeaddresschoix="inputaddress",this.fromToTag.typezipcodechoix="inputzipcode",this.fromToTag.typecitychoix="inputcity"}actionsClickInput(t){let e=!1;this.#l=this.#p[t];let s=this.#u.getValueIdTag(t);s!==this.#C[t]&&(e=!0),this.#C[t]=s,s.length>miniInput[t]&&(e=!0),e?this.#c.getDataIdTag(s,t).then((t=>this.#l.fillChilds(t))):this.#l.affichChilds()}actionsClickOnChoix(t,e){let s=this.fromToTag[t],i=this.#p[s].getDatafromId(e);this.#u.fillInputsfrom(t,i),this.#p[s].hideChilds()}actionClickOther(){for(let t in this.#p)this.#p.hasOwnProperty(t)&&this.#p[t].hideChilds()}onInput(t){this.#u.setNaInput(t),this.actionsClickInput(t)}};export function addlisteners(){let t=new FormActions;document.addEventListener("click",(function(e){let s=e.target.id,i=e.target.getAttribute(divTagType),d=e.target.getAttribute("data-name");"inputaddress"===d||"inputcity"===d||"inputzipcode"===d?t.actionsClickInput("inputaddress"):"typeaddresschoix"===i||"typezipcodechoix"===i||"typecitychoix"===i?t.actionsClickOnChoix(i,s):t.actionClickOther()})),setTimeout((function(){document.addEventListener("input",(function(e){let s=e.target.value.length,i=e.target.getAttribute("data-name");s>3&&t.onInput(i)}))}),1e3)}let inputToFill={};inputToFill.typeaddresschoix=FiedsNamesAddressJson;export const FormAddressInputs=class{#y;#m;#x;#A;#g;#v;#f;#N;#T;#F;#I;constructor(){let t=document.getElementsByTagName("input");if(t.length>0)for(let e=0;e<t.length;e++){let s=t[e].getAttribute("data-name");"inputaddress"===s&&(this.#y=t[e]),"inputrefaddress"===s&&(this.#m=t[e]),"inputnoaddress"===s&&(this.#x=t[e]),"inputstreetaddress"===s&&(this.#A=t[e]),"inputlataddress"===s&&(this.#g=t[e]),"inputlonaddress"===s&&(this.#v=t[e]),"inputzipcode"===s&&(this.#f=t[e]),"inputcodecity"===s&&(this.#N=t[e]),"inputcity"===s&&(this.#T=t[e])}this.#F={},this.#F.inputaddress=this.#y,this.#F.inputzipcode=this.#f,this.#F.inputcity=this.#T,this.#I={},this.#I.typeaddresschoix=FiedsNamesAddressJson,this.#I.typezipcodechoix=FieldsNameGeoJson,this.#I.typecitychoix=FieldsNameGeoJson}getValueIdTag(t){return this.validateInputZipCodeValueFrom(t),this.#F[t].value}validateInputZipCodeValueFrom(t){if("typezipcodechoix"===t){let t=this.#f.value;4===t.length&&(this.#f.value="0"+t)}}fillAllAddressInputs(t){this.#y.value=t[FiedsNamesAddressJson.short],this.#m.value=t[FiedsNamesAddressJson.id],this.#x.value=t[FiedsNamesAddressJson.no],this.#A.value=t[FiedsNamesAddressJson.street],this.#g.value=t[FiedsNamesAddressJson.lat],this.#v.value=t[FiedsNamesAddressJson.lon],this.setInputAddressAutoTrue()}fillZipCode(t,e){if(this.condtionToFillZipCode()){let s=this.#I[e].zipcode;this.#f.value=t[s],this.setInputZipCodeAutoTrue()}}fillAllCity(t,e){if(this.condtionToFillCity()){let s=this.#I[e].city,i=this.#I[e].codecity;this.#N.value=t[i],this.#T.value=t[s],this.setInputCityAutoTrue()}}fillInputsfrom(t,e){switch(t){case"typeaddresschoix":this.fillAllAddressInputs(e),this.fillZipCode(e,t),this.fillAllCity(e,t);break;case"typezipcodechoix":this.#f.value="",this.fillZipCode(e,t),this.fillAllCity(e,t),this.adressNASemi();break;case"typecitychoix":this.#T.value="",this.fillZipCode(e,t),this.fillAllCity(e,t),this.adressNASemi()}}condtionToFillZipCode(){return""===this.#f.value||"true"===this.#f.getAttribute("data-auto")}condtionToFillCity(){return""===this.#T.value||"true"===this.#T.getAttribute("data-auto")}zipCodeNA(){this.setInputZipCodeAutoFalse()}cityNA(){this.#N.value="NaN",this.setInputCityAutoFalse()}adressNASemi(){this.#m.value="NaN",this.setInputAddressAutoFalse()}addressNA(){this.#m.value="NaN",this.#x.value="NaN",this.#A.value="NaN",this.#g.value="NaN",this.#v.value="NaN",this.setInputAddressAutoFalse()}setNaInput(t){switch(t){case"inputaddress":this.addressNA();break;case"inputzipcode":this.zipCodeNA();break;case"inputcity":this.cityNA()}}setInputAddressAuto(t="false"){this.#y.setAttribute("data-auto",t)}setInputZipCodeAuto(t="false"){this.#f.setAttribute("data-auto",t)}setInputCityAuto(t="false"){this.#T.setAttribute("data-auto",t)}setInputAddressAutoFalse(){this.setInputAddressAuto("false")}setInputZipCodeAutoFalse(){this.setInputZipCodeAuto("false")}setInputCityAutoFalse(){this.setInputCityAuto("false")}setInputAddressAutoTrue(){this.setInputAddressAuto("true")}setInputZipCodeAutoTrue(){this.setInputZipCodeAuto("true")}setInputCityAutoTrue(){this.setInputCityAuto("true")}};document.addEventListener("DOMContentLoaded",(function(){addlisteners()}));
//# sourceMappingURL=formaddress.js.map
